name: healthy-check

on:
    schedule:
        - cron: "0 0 * * *"

jobs:
    healthy-check:
        runs-on: ubuntu-latest

        steps:
            - name: system health check
              env:
                  API_URL: ${{ secrets.API_URL }}
                  API_KEY: ${{ secrets.API_KEY }}
              run: |
                  set -e

                  ENDPOINT="/health-check"

                  if [ -z "$API_URL" ]; then
                    echo "API_URL is empty"
                    exit 1
                  fi

                  if [ -z "$API_KEY" ]; then
                    echo "API_KEY is empty"
                    exit 1
                  fi

                  FULL_URL="${API_URL%/}${ENDPOINT}"

                  curl -X GET "$FULL_URL" \
                    -H "Authorization: $API_KEY"
